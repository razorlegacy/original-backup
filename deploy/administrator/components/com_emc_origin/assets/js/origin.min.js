/*Uploader*/
(function(e){"function"===typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)})(function(e){e.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader);e.support.xhrFormDataFileUpload=!!window.FormData;e.widget("blueimp.fileupload",{options:{namespace:void 0,dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,
forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(a){return a.serializeArray()},add:function(a,b){b.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:"namespace fileInput dropZone pasteZone multipart forceIframeTransport".split(" "),_BitrateTimer:function(){this.timestamp=+new Date;this.bitrate=this.loaded=0;this.getBitrate=
function(a,b,c){var d=a-this.timestamp;if(!this.bitrate||!c||d>c)this.bitrate=8*(b-this.loaded)*(1E3/d),this.loaded=b,this.timestamp=a;return this.bitrate}},_isXHRUpload:function(a){return!a.forceIframeTransport&&(!a.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(a){var b;return"function"===typeof a.formData?a.formData(a.form):e.isArray(a.formData)?a.formData:a.formData?(b=[],e.each(a.formData,function(a,d){b.push({name:a,value:d})}),b):[]},_getTotal:function(a){var b=
0;e.each(a,function(a,d){b+=d.size||1});return b},_onProgress:function(a,b){if(a.lengthComputable){var c=+new Date,d,e;if(!b._time||!b.progressInterval||!(c-b._time<b.progressInterval&&a.loaded!==a.total))b._time=c,d=b.total||this._getTotal(b.files),e=parseInt(a.loaded/a.total*(b.chunkSize||d),10)+(b.uploadedBytes||0),this._loaded+=e-(b.loaded||b.uploadedBytes||0),b.lengthComputable=!0,b.loaded=e,b.total=d,b.bitrate=b._bitrateTimer.getBitrate(c,e,b.bitrateInterval),this._trigger("progress",a,b),this._trigger("progressall",
a,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(c,this._loaded,b.bitrateInterval)})}},_initProgressListener:function(a){var b=this,c=a.xhr?a.xhr():e.ajaxSettings.xhr();c.upload&&(e(c.upload).bind("progress",function(d){var c=d.originalEvent;d.lengthComputable=c.lengthComputable;d.loaded=c.loaded;d.total=c.total;b._onProgress(d,a)}),a.xhr=function(){return c})},_initXHRData:function(a){var b,c=a.files[0],d=a.multipart||!e.support.xhrFileUpload,f=a.paramName[0];
if(!d||a.blob)a.headers=e.extend(a.headers,{"X-File-Name":c.name,"X-File-Type":c.type,"X-File-Size":c.size}),a.blob?d||(a.contentType="application/octet-stream",a.data=a.blob):(a.contentType=c.type,a.data=c);d&&e.support.xhrFormDataFileUpload&&(a.postMessage?(b=this._getFormData(a),a.blob?b.push({name:f,value:a.blob}):e.each(a.files,function(c,d){b.push({name:a.paramName[c]||f,value:d})})):(a.formData instanceof FormData?b=a.formData:(b=new FormData,e.each(this._getFormData(a),function(a,c){b.append(c.name,
c.value)})),a.blob?b.append(f,a.blob,c.name):e.each(a.files,function(c,d){d instanceof Blob&&b.append(a.paramName[c]||f,d,d.name)})),a.data=b);a.blob=null},_initIframeSettings:function(a){a.dataType="iframe "+(a.dataType||"");a.formData=this._getFormData(a);a.redirect&&e("<a></a>").prop("href",a.url).prop("host")!==location.host&&a.formData.push({name:a.redirectParamName||"redirect",value:a.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),
this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a,"iframe")},_getParamName:function(a){var b=e(a.fileInput),c=a.paramName;c?e.isArray(c)||(c=[c]):(c=[],b.each(function(){for(var a=e(this),b=a.prop("name")||"files[]",a=(a.prop("files")||[1]).length;a;)c.push(b),a-=1}),c.length||(c=[b.prop("name")||"files[]"]));return c},_initFormSettings:function(a){if(!a.form||!a.form.length)a.form=e(a.fileInput.prop("form")),a.form.length||(a.form=
e(this.options.fileInput.prop("form")));a.paramName=this._getParamName(a);a.url||(a.url=a.form.prop("action")||location.href);a.type=(a.type||a.form.prop("method")||"").toUpperCase();"POST"!==a.type&&"PUT"!==a.type&&(a.type="POST");a.formAcceptCharset||(a.formAcceptCharset=a.form.attr("accept-charset"))},_getAJAXSettings:function(a){a=e.extend({},this.options,a);this._initFormSettings(a);this._initDataSettings(a);return a},_enhancePromise:function(a){a.success=a.done;a.error=a.fail;a.complete=a.always;
return a},_getXHRPromise:function(a,b,c){var d=e.Deferred(),f=d.promise(),b=b||this.options.context||f;!0===a?d.resolveWith(b,c):!1===a&&d.rejectWith(b,c);f.abort=d.promise;return this._enhancePromise(f)},_chunkedUpload:function(a,b){var c=this,d=a.files[0],f=d.size,g=a.uploadedBytes=a.uploadedBytes||0,h=a.maxChunkSize||f,i=d.slice||d.webkitSlice||d.mozSlice,k,j,l;if(!this._isXHRUpload(a)||(!i||!(g||h<f))||a.data)return!1;if(b)return!0;if(g>=f)return d.error="Uploaded bytes exceed file size",this._getXHRPromise(!1,
a.context,[null,"error",d.error]);j=Math.ceil((f-g)/h);k=function(b){return!b?c._getXHRPromise(!0,a.context):k(b-=1).pipe(function(){var f=e.extend({},a);f.blob=i.call(d,g+b*h,g+(b+1)*h);f.chunkIndex=b;f.chunksNumber=j;f.chunkSize=f.blob.size;c._initXHRData(f);c._initProgressListener(f);return l=(e.ajax(f)||c._getXHRPromise(!1,f.context)).done(function(){f.loaded||c._onProgress(e.Event("progress",{lengthComputable:!0,loaded:f.chunkSize,total:f.chunkSize}),f);a.uploadedBytes=f.uploadedBytes+=f.chunkSize})})};
f=k(j);f.abort=function(){return l.abort()};return this._enhancePromise(f)},_beforeSend:function(a,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer);this._active+=1;this._loaded+=b.uploadedBytes||0;this._total+=this._getTotal(b.files)},_onDone:function(a,b,c,d){this._isXHRUpload(d)||this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:1,total:1}),d);d.result=a;d.textStatus=b;d.jqXHR=c;this._trigger("done",null,d)},_onFail:function(a,b,c,d){d.jqXHR=
a;d.textStatus=b;d.errorThrown=c;this._trigger("fail",null,d);d.recalculateProgress&&(this._loaded-=d.loaded||d.uploadedBytes||0,this._total-=d.total||this._getTotal(d.files))},_onAlways:function(a,b,c,d){this._active-=1;d.textStatus=b;c&&c.always?(d.jqXHR=c,d.result=a):(d.jqXHR=a,d.errorThrown=c);this._trigger("always",null,d);0===this._active&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(a,b){var c=this,d,f,g,h=c._getAJAXSettings(b),i=function(b,f){c._sending+=
1;h._bitrateTimer=new c._BitrateTimer;return d=d||(!1!==b&&!1!==c._trigger("send",a,h)&&(c._chunkedUpload(h)||e.ajax(h))||c._getXHRPromise(!1,h.context,f)).done(function(a,b,d){c._onDone(a,b,d,h)}).fail(function(a,b,d){c._onFail(a,b,d,h)}).always(function(a,b,d){c._sending-=1;c._onAlways(a,b,d,h);if(h.limitConcurrentUploads&&h.limitConcurrentUploads>c._sending)for(a=c._slots.shift();a;){if(b=a.state?"pending"===a.state():!a.isRejected()){a.resolve();break}a=c._slots.shift()}})};this._beforeSend(a,
h);return this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(1<this.options.limitConcurrentUploads?(f=e.Deferred(),this._slots.push(f),g=f.pipe(i)):g=this._sequence=this._sequence.pipe(i,i),g.abort=function(){var a=[void 0,"abort","abort"];return!d?(f&&f.rejectWith(g,a),i(!1,a)):d.abort()},this._enhancePromise(g)):i()},_onAdd:function(a,b){var c=this,d=!0,f=e.extend({},this.options,b),g=f.limitMultiFileUploads,h=this._getParamName(f),
i,k,j;if(!f.singleFileUploads&&!g||!this._isXHRUpload(f))k=[b.files],i=[h];else if(!f.singleFileUploads&&g){k=[];i=[];for(j=0;j<b.files.length;j+=g)k.push(b.files.slice(j,j+g)),f=h.slice(j,j+g),f.length||(f=h),i.push(f)}else i=h;b.originalFiles=b.files;e.each(k||b.files,function(f,h){var g=e.extend({},b);g.files=k?h:[h];g.paramName=i[f];g.submit=function(){return g.jqXHR=this.jqXHR=!1!==c._trigger("submit",a,this)&&c._onSend(a,this)};return d=c._trigger("add",a,g)});return d},_replaceFileInput:function(a){var b=
a.clone(!0);e("<form></form>").append(b)[0].reset();a.after(b).detach();e.cleanData(a.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(c,d){return d===a[0]?b[0]:d});a[0]===this.element[0]&&(this.element=b)},_handleFileTreeEntry:function(a,b){var c=this,d=e.Deferred(),f=function(b){b&&!b.entry&&(b.entry=a);d.resolve([b])},g,b=b||"";a.isFile?a._file?(a._file.relativePath=b,d.resolve(a._file)):a.file(function(a){a.relativePath=b;d.resolve(a)},f):a.isDirectory?(g=a.createReader(),
g.readEntries(function(e){c._handleFileTreeEntries(e,b+a.name+"/").done(function(a){d.resolve(a)}).fail(f)},f)):d.resolve([]);return d.promise()},_handleFileTreeEntries:function(a,b){var c=this;return e.when.apply(e,e.map(a,function(a){return c._handleFileTreeEntry(a,b)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(a){var a=a||{},b=a.items;return b&&b.length&&(b[0].webkitGetAsEntry||b[0].getAsEntry)?this._handleFileTreeEntries(e.map(b,function(a){var b;
return a.webkitGetAsEntry?(b=a.webkitGetAsEntry(),b._file=a.getAsFile(),b):a.getAsEntry()})):e.Deferred().resolve(e.makeArray(a.files)).promise()},_getSingleFileInputFiles:function(a){var a=e(a),b=a.prop("webkitEntries")||a.prop("entries");if(b&&b.length)return this._handleFileTreeEntries(b);b=e.makeArray(a.prop("files"));if(!b.length){a=a.prop("value");if(!a)return e.Deferred().resolve([]).promise();b=[{name:a.replace(/^.*\\/,"")}]}return e.Deferred().resolve(b).promise()},_getFileInputFiles:function(a){return!(a instanceof
e)||1===a.length?this._getSingleFileInputFiles(a):e.when.apply(e,e.map(a,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(a){var b=a.data.fileupload,c={fileInput:e(a.target),form:e(a.target.form)};b._getFileInputFiles(c.fileInput).always(function(d){c.files=d;b.options.replaceFileInput&&b._replaceFileInput(c.fileInput);!1!==b._trigger("change",a,c)&&b._onAdd(a,c)})},_onPaste:function(a){var b=a.data.fileupload,c=a.originalEvent.clipboardData,
d={files:[]};e.each(c&&c.items||[],function(a,b){var c=b.getAsFile&&b.getAsFile();c&&d.files.push(c)});if(!1===b._trigger("paste",a,d)||!1===b._onAdd(a,d))return!1},_onDrop:function(a){a.preventDefault();var b=a.data.fileupload,c=a.dataTransfer=a.originalEvent.dataTransfer,d={};b._getDroppedFiles(c).always(function(c){d.files=c;!1!==b._trigger("drop",a,d)&&b._onAdd(a,d)})},_onDragOver:function(a){var b=a.data.fileupload,c=a.dataTransfer=a.originalEvent.dataTransfer;if(!1===b._trigger("dragover",a))return!1;
c&&(c.dropEffect="copy");a.preventDefault()},_initEventHandlers:function(){var a=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+a,{fileupload:this},this._onDragOver).bind("drop."+a,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+a,{fileupload:this},this._onPaste));this.options.fileInput.bind("change."+a,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var a=this.options.namespace;this.options.dropZone.unbind("dragover."+
a,this._onDragOver).unbind("drop."+a,this._onDrop);this.options.pasteZone.unbind("paste."+a,this._onPaste);this.options.fileInput.unbind("change."+a,this._onChange)},_setOption:function(a,b){var c=-1!==e.inArray(a,this._refreshOptionsList);c&&this._destroyEventHandlers();e.Widget.prototype._setOption.call(this,a,b);c&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var a=this.options;void 0===a.fileInput?a.fileInput=this.element.is('input[type="file"]')?this.element:
this.element.find('input[type="file"]'):a.fileInput instanceof e||(a.fileInput=e(a.fileInput));a.dropZone instanceof e||(a.dropZone=e(a.dropZone));a.pasteZone instanceof e||(a.pasteZone=e(a.pasteZone))},_create:function(){var a=this.options;e.extend(a,e(this.element[0].cloneNode(!1)).data());a.namespace=a.namespace||this.widgetName;this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=this._loaded=this._total=0;this._initEventHandlers()},destroy:function(){this._destroyEventHandlers();
e.Widget.prototype.destroy.call(this)},enable:function(){var a=!1;this.options.disabled&&(a=!0);e.Widget.prototype.enable.call(this);a&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers();e.Widget.prototype.disable.call(this)},add:function(a){var b=this;a&&!this.options.disabled&&(a.fileInput&&!a.files?this._getFileInputFiles(a.fileInput).always(function(c){a.files=c;b._onAdd(null,a)}):(a.files=e.makeArray(a.files),this._onAdd(null,a)))},send:function(a){if(a&&
!this.options.disabled){if(a.fileInput&&!a.files){var b=this,c=e.Deferred(),d=c.promise(),f,g;d.abort=function(){g=!0;if(f)return f.abort();c.reject(null,"abort","abort");return d};this._getFileInputFiles(a.fileInput).always(function(d){g||(a.files=d,f=b._onSend(null,a).then(function(a,b,d){c.resolve(a,b,d)},function(a,b,d){c.reject(a,b,d)}))});return this._enhancePromise(d)}a.files=e.makeArray(a.files);if(a.files.length)return this._onSend(null,a)}return this._getXHRPromise(!1,a&&a.context)}})});

/*Upload Iframe*/
(function(b){"function"===typeof define&&define.amd?define(["jquery"],b):b(window.jQuery)})(function(b){var f=0;b.ajaxTransport("iframe",function(a){if(a.async&&("POST"===a.type||"GET"===a.type)){var c,d;return{send:function(h,g){c=b('<form style="display:none;"></form>');c.attr("accept-charset",a.formAcceptCharset);d=b('<iframe src="javascript:false;" name="iframe-transport-'+(f+=1)+'"></iframe>').bind("load",function(){var e,f=b.isArray(a.paramName)?a.paramName:[a.paramName];d.unbind("load").bind("load",
function(){var a;try{if(a=d.contents(),!a.length||!a[0].firstChild)throw Error();}catch(i){a=void 0}g(200,"success",{iframe:a});b('<iframe src="javascript:false;"></iframe>').appendTo(c);c.remove()});c.prop("target",d.prop("name")).prop("action",a.url).prop("method",a.type);a.formData&&b.each(a.formData,function(a,d){b('<input type="hidden"/>').prop("name",d.name).val(d.value).appendTo(c)});a.fileInput&&(a.fileInput.length&&"POST"===a.type)&&(e=a.fileInput.clone(),a.fileInput.after(function(a){return e[a]}),
a.paramName&&a.fileInput.each(function(c){b(this).prop("name",f[c]||a.paramName)}),c.append(a.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"));c.submit();e&&e.length&&a.fileInput.each(function(a,c){var d=b(e[a]);b(c).prop("name",d.prop("name"));d.replaceWith(c)})});c.append(d).appendTo(document.body)},abort:function(){d&&d.unbind("load").prop("src","javascript".concat(":false;"));c&&c.remove()}}}});b.ajaxSetup({converters:{"iframe text":function(a){return b(a[0].body).text()},
"iframe json":function(a){return b.parseJSON(b(a[0].body).text())},"iframe html":function(a){return b(a[0].body).html()},"iframe script":function(a){return b.globalEval(b(a[0].body).text())}}})});

/*Uploader UI*/
(function(d){"function"===typeof define&&define.amd?define(["jquery","tmpl","load-image","./jquery.fileupload-fp"],d):d(window.jQuery,window.tmpl,window.loadImage)})(function(d,i,j){var g=(d.blueimpFP||d.blueimp).fileupload;d.widget("blueimpUI.fileupload",g,{options:{autoUpload:!1,maxNumberOfFiles:void 0,maxFileSize:void 0,minFileSize:void 0,acceptFileTypes:/.+$/i,previewSourceFileTypes:/^image\/(gif|jpeg|png)$/,previewSourceMaxFileSize:5E6,previewMaxWidth:80,previewMaxHeight:80,previewAsCanvas:!0,
uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",add:function(a,b){var c=d(this).data("fileupload"),e=c.options,f=b.files;d(this).fileupload("process",b).done(function(){c._adjustMaxNumberOfFiles(-f.length);b.maxNumberOfFilesAdjusted=!0;b.files.valid=b.isValidated=c._validate(f);b.context=c._renderUpload(f).data("data",b);e.filesContainer[e.prependFiles?"prepend":"append"](b.context);c._renderPreviews(f,b.context);c._forceReflow(b.context);
c._transition(b.context).done(function(){!1!==c._trigger("added",a,b)&&((e.autoUpload||b.autoUpload)&&!1!==b.autoUpload&&b.isValidated)&&b.submit()})})},send:function(a,b){var c=d(this).data("fileupload");if(!b.isValidated&&(b.maxNumberOfFilesAdjusted||(c._adjustMaxNumberOfFiles(-b.files.length),b.maxNumberOfFilesAdjusted=!0),!c._validate(b.files)))return!1;b.context&&(b.dataType&&"iframe"===b.dataType.substr(0,6))&&b.context.find(".progress").addClass(!d.support.transition&&"progress-animated").attr("aria-valuenow",
100).find(".bar").css("width","100%");return c._trigger("sent",a,b)},done:function(a,b){var c=d(this).data("fileupload"),e;b.context?b.context.each(function(f){var h=d.isArray(b.result)&&b.result[f]||{error:"Empty file upload result"};h.error&&c._adjustMaxNumberOfFiles(1);c._transition(d(this)).done(function(){var f=d(this);e=c._renderDownload([h]).replaceAll(f);c._forceReflow(e);c._transition(e).done(function(){b.context=d(this);c._trigger("completed",a,b)})})}):(d.isArray(b.result)&&(d.each(b.result,
function(a,d){b.maxNumberOfFilesAdjusted&&d.error?c._adjustMaxNumberOfFiles(1):!b.maxNumberOfFilesAdjusted&&!d.error&&c._adjustMaxNumberOfFiles(-1)}),b.maxNumberOfFilesAdjusted=!0),e=c._renderDownload(b.result).appendTo(c.options.filesContainer),c._forceReflow(e),c._transition(e).done(function(){b.context=d(this);c._trigger("completed",a,b)}))},fail:function(a,b){var c=d(this).data("fileupload"),e;b.maxNumberOfFilesAdjusted&&c._adjustMaxNumberOfFiles(b.files.length);b.context?b.context.each(function(f){if("abort"!==
b.errorThrown){var h=b.files[f];h.error=h.error||b.errorThrown||!0;c._transition(d(this)).done(function(){var f=d(this);e=c._renderDownload([h]).replaceAll(f);c._forceReflow(e);c._transition(e).done(function(){b.context=d(this);c._trigger("failed",a,b)})})}else c._transition(d(this)).done(function(){d(this).remove();c._trigger("failed",a,b)})}):"abort"!==b.errorThrown?(b.context=c._renderUpload(b.files).appendTo(c.options.filesContainer).data("data",b),c._forceReflow(b.context),c._transition(b.context).done(function(){b.context=
d(this);c._trigger("failed",a,b)})):c._trigger("failed",a,b)},progress:function(a,b){if(b.context){var c=parseInt(100*(b.loaded/b.total),10);b.context.find(".progress").attr("aria-valuenow",c).find(".bar").css("width",c+"%")}},progressall:function(a,b){var c=d(this),e=parseInt(100*(b.loaded/b.total),10),f=c.find(".fileupload-progress"),h=f.find(".progress-extended");h.length&&h.html(c.data("fileupload")._renderExtendedProgress(b));f.find(".progress").attr("aria-valuenow",e).find(".bar").css("width",
e+"%")},start:function(a){var b=d(this).data("fileupload");b._transition(d(this).find(".fileupload-progress")).done(function(){b._trigger("started",a)})},stop:function(a){var b=d(this).data("fileupload");b._transition(d(this).find(".fileupload-progress")).done(function(){d(this).find(".progress").attr("aria-valuenow","0").find(".bar").css("width","0%");d(this).find(".progress-extended").html("&nbsp;");b._trigger("stopped",a)})},destroy:function(a,b){var c=d(this).data("fileupload");b.url&&(d.ajax(b),
c._adjustMaxNumberOfFiles(1));c._transition(b.context).done(function(){d(this).remove();c._trigger("destroyed",a,b)})}},_enableDragToDesktop:function(){var a=d(this),b=a.prop("href"),c=a.prop("download");a.bind("dragstart",function(a){try{a.originalEvent.dataTransfer.setData("DownloadURL",["application/octet-stream",c,b].join(":"))}catch(d){}})},_adjustMaxNumberOfFiles:function(a){"number"===typeof this.options.maxNumberOfFiles&&(this.options.maxNumberOfFiles+=a,1>this.options.maxNumberOfFiles?this._disableFileInputButton():
this._enableFileInputButton())},_formatFileSize:function(a){return"number"!==typeof a?"":1E9<=a?(a/1E9).toFixed(2)+" GB":1E6<=a?(a/1E6).toFixed(2)+" MB":(a/1E3).toFixed(2)+" KB"},_formatBitrate:function(a){return"number"!==typeof a?"":1E9<=a?(a/1E9).toFixed(2)+" Gbit/s":1E6<=a?(a/1E6).toFixed(2)+" Mbit/s":1E3<=a?(a/1E3).toFixed(2)+" kbit/s":a+" bit/s"},_formatTime:function(a){var b=new Date(1E3*a),a=parseInt(a/86400,10);return(a?a+"d ":"")+("0"+b.getUTCHours()).slice(-2)+":"+("0"+b.getUTCMinutes()).slice(-2)+
":"+("0"+b.getUTCSeconds()).slice(-2)},_formatPercentage:function(a){return(100*a).toFixed(2)+" %"},_renderExtendedProgress:function(a){return this._formatBitrate(a.bitrate)+" | "+this._formatTime(8*(a.total-a.loaded)/a.bitrate)+" | "+this._formatPercentage(a.loaded/a.total)+" | "+this._formatFileSize(a.loaded)+" / "+this._formatFileSize(a.total)},_hasError:function(a){return a.error?a.error:0>this.options.maxNumberOfFiles?"maxNumberOfFiles":!this.options.acceptFileTypes.test(a.type)&&!this.options.acceptFileTypes.test(a.name)?
"acceptFileTypes":this.options.maxFileSize&&a.size>this.options.maxFileSize?"maxFileSize":"number"===typeof a.size&&a.size<this.options.minFileSize?"minFileSize":null},_validate:function(a){var b=this,c=!!a.length;d.each(a,function(a,d){d.error=b._hasError(d);d.error&&(c=!1)});return c},_renderTemplate:function(a,b){if(!a)return d();var c=a({files:b,formatFileSize:this._formatFileSize,options:this.options});return c instanceof d?c:d(this.options.templatesContainer).html(c).children()},_renderPreview:function(a,
b){var c=this,e=this.options,f=d.Deferred();return(j&&j(a,function(a){b.append(a);c._forceReflow(b);c._transition(b).done(function(){f.resolveWith(b)});d.contains(document.body,b[0])||f.resolveWith(b)},{maxWidth:e.previewMaxWidth,maxHeight:e.previewMaxHeight,canvas:e.previewAsCanvas})||f.resolveWith(b))&&f},_renderPreviews:function(a,b){var c=this,e=this.options;b.find(".preview span").each(function(b,h){var g=a[b];if(e.previewSourceFileTypes.test(g.type)&&("number"!==d.type(e.previewSourceMaxFileSize)||
g.size<e.previewSourceMaxFileSize))c._processingQueue=c._processingQueue.pipe(function(){var a=d.Deferred();c._renderPreview(g,d(h)).done(function(){a.resolveWith(c)});return a.promise()})});return this._processingQueue},_renderUpload:function(a){return this._renderTemplate(this.options.uploadTemplate,a)},_renderDownload:function(a){return this._renderTemplate(this.options.downloadTemplate,a).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(a){a.preventDefault();var a=
d(this),b=a.closest(".template-upload").data("data");b&&(b.submit&&!b.jqXHR&&b.submit())&&a.prop("disabled",!0)},_cancelHandler:function(a){a.preventDefault();var b=d(this).closest(".template-upload").data("data")||{};b.jqXHR?b.jqXHR.abort():(b.errorThrown="abort",a.data.fileupload._trigger("fail",a,b))},_deleteHandler:function(a){a.preventDefault();var b=d(this);a.data.fileupload._trigger("destroy",a,{context:b.closest(".template-download"),url:b.attr("data-url"),type:b.attr("data-type")||"DELETE",
dataType:a.data.fileupload.options.dataType})},_forceReflow:function(a){return d.support.transition&&a.length&&a[0].offsetWidth},_transition:function(a){var b=d.Deferred();d.support.transition&&a.hasClass("fade")?a.bind(d.support.transition.end,function(c){c.target===a[0]&&(a.unbind(d.support.transition.end),b.resolveWith(a))}).toggleClass("in"):(a.toggleClass("in"),b.resolveWith(a));return b},_initButtonBarEventHandlers:function(){var a=this.element.find(".fileupload-buttonbar"),b=this.options.filesContainer,
c=this.options.namespace;a.find(".start").bind("click."+c,function(a){a.preventDefault();b.find(".start button").click()});a.find(".cancel").bind("click."+c,function(a){a.preventDefault();b.find(".cancel button").click()});a.find(".delete").bind("click."+c,function(c){c.preventDefault();b.find(".delete input:checked").siblings("button").click();a.find(".toggle").prop("checked",!1)});a.find(".toggle").bind("change."+c,function(){b.find(".delete input").prop("checked",d(this).is(":checked"))})},_destroyButtonBarEventHandlers:function(){this.element.find(".fileupload-buttonbar button").unbind("click."+
this.options.namespace);this.element.find(".fileupload-buttonbar .toggle").unbind("change."+this.options.namespace)},_initEventHandlers:function(){g.prototype._initEventHandlers.call(this);var a={fileupload:this};this.options.filesContainer.delegate(".start button","click."+this.options.namespace,a,this._startHandler).delegate(".cancel button","click."+this.options.namespace,a,this._cancelHandler).delegate(".delete button","click."+this.options.namespace,a,this._deleteHandler);this._initButtonBarEventHandlers()},
_destroyEventHandlers:function(){var a=this.options;this._destroyButtonBarEventHandlers();a.filesContainer.undelegate(".start button","click."+a.namespace).undelegate(".cancel button","click."+a.namespace).undelegate(".delete button","click."+a.namespace);g.prototype._destroyEventHandlers.call(this)},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",
!0).parent().addClass("disabled")},_initTemplates:function(){var a=this.options;a.templatesContainer=document.createElement(a.filesContainer.prop("nodeName"));i&&(a.uploadTemplateId&&(a.uploadTemplate=i(a.uploadTemplateId)),a.downloadTemplateId&&(a.downloadTemplate=i(a.downloadTemplateId)))},_initFilesContainer:function(){var a=this.options;void 0===a.filesContainer?a.filesContainer=this.element.find(".files"):a.filesContainer instanceof d||(a.filesContainer=d(a.filesContainer))},_stringToRegExp:function(a){var a=
a.split("/"),b=a.pop();a.shift();return RegExp(a.join("/"),b)},_initRegExpOptions:function(){var a=this.options;"string"===d.type(a.acceptFileTypes)&&(a.acceptFileTypes=this._stringToRegExp(a.acceptFileTypes));"string"===d.type(a.previewSourceFileTypes)&&(a.previewSourceFileTypes=this._stringToRegExp(a.previewSourceFileTypes))},_initSpecialOptions:function(){g.prototype._initSpecialOptions.call(this);this._initFilesContainer();this._initTemplates();this._initRegExpOptions()},_create:function(){g.prototype._create.call(this);
this._refreshOptionsList.push("filesContainer","uploadTemplateId","downloadTemplateId");d.blueimpFP||(this._processingQueue=d.Deferred().resolveWith(this).promise(),this.process=function(){return this._processingQueue})},enable:function(){var a=!1;this.options.disabled&&(a=!0);g.prototype.enable.call(this);a&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton());
g.prototype.disable.call(this)}})});